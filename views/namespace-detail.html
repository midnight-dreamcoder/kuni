<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} - K8s Universal Inspector</title>
    <link rel="stylesheet" href="/style.css{{ .CacheBuster }}">
</head>
<body>

    {{ template "sidebar" . }}

    <main class="main-content">
        <h1>{{ .NamespaceName }}</h1>
        <div class="page-subtitle">
            Namespace details, found in {{ len .ClusterNames }} cluster(s).
        </div>

        {{ if .ErrorLogs }}
        <div class="errors">
            <h2>Errors</h2>
            <ul>
                {{ range .ErrorLogs }} <li>{{ . }}</li> {{ end }}
            </ul>
        </div>
        {{ end }}
        
        <div class="tabs-container">
            {{ if .ClusterNames }}
                {{ range $index, $cluster := .ClusterNames }}
                    <button class="tab-btn {{ if eq $index 0 }}active{{ end }}" 
                            onclick="openTab('{{ $cluster }}', this)">
                        {{ $cluster }}
                    </button>
                {{ end }}
            {{ else }}
                <div class="no-data" style="padding: 1rem 0;">No matching namespace found in selected clusters.</div>
            {{ end }}
        </div>

        {{ range $index, $cluster := .ClusterNames }}
            {{ $detail := index $.Details $cluster }}
            
            <div id="tab-{{ $cluster }}" class="deployment-content {{ if eq $index 0 }}active{{ end }}">
                
                <div class="stats-container three-col" style="margin-bottom: 1.5rem;">
                    <div class="stat-box green">
                        <h3>Deployments</h3>
                        <div class="total">{{ $detail.TotalDeployments }}</div>
                    </div>
                    <div class="stat-box purple">
                        <h3>Pods</h3>
                        <div class="total">{{ $detail.TotalPods }}</div>
                    </div>
                    <div class="stat-box">
                        <h3>ReplicaSets</h3>
                        <div class="total">{{ $detail.TotalReplicaSets }}</div>
                    </div>
                </div>

                <div class="container" style="margin-bottom: 1.5rem;">
                    <h2>Deployments</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Ready</th>
                                <th>Images</th>
                                <th>Strategy</th>
                                <th>Age</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{ range $detail.Deployments }}
                            <tr>
                                <td>
                                    <a href="{{ MakeURL $.QueryString "/deployment/detail" "name" .Name }}" class="deployment-link">
                                        {{ .Name }}
                                    </a>
                                </td>
                                <td>{{ .Ready }}</td>
                                <td class="col-tags">
                                    {{ range .Images }} <span class="image-tag">{{ . }}</span> {{ end }}
                                </td>
                                <td><span class="strategy-tag">{{ .Strategy }}</span></td>
                                <td>{{ .Age }}</td>
                            </tr>
                            {{ else }}
                            <tr><td colspan="5" class="no-data">No deployments found.</td></tr>
                            {{ end }}
                        </tbody>
                    </table>
                </div>

                <div class="container" style="margin-bottom: 1.5rem;">
                    <h2>Pods</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Ready</th>
                                <th>Status</th>
                                <th>Reason</th>
                                <th>Restarts</th>
                                <th>Pod IP</th>
                                <th>Node</th>
                                <th>Age</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{ range $detail.Pods }}
                            <tr>
                                <td>
                                    <a href="{{ MakeURL $.QueryString "/pod/detail" "name" .Name "namespace" $.NamespaceName "cluster_name" .Cluster }}" class="deployment-link">
                                        {{ .Name }}
                                    </a>
                                </td>
                                <td>{{ .Ready }}</td>
                                <td><span class="status status-{{ .Status | ToLower }}">{{ .Status }}</span></td>
                                <td class="reason-col">{{ .Reason }}</td>
                                <td>{{ .Restarts }}</td>
                                <td>{{ .PodIP }}</td>
                                <td>{{ .Node }}</td>
                                <td>{{ .Age }}</td>
                            </tr>
                            {{ else }}
                            <tr><td colspan="8" class="no-data">No pods found.</td></tr>
                            {{ end }}
                        </tbody>
                    </table>
                </div>

                <div class="container">
                    <h2>ReplicaSets</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Replicas (R/D/C)</th>
                                <th>Owned By</th>
                                <th>Age</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{ range $detail.ReplicaSets }}
                            <tr>
                                <td>
                                    <a href="/search?q={{ .Name | urlquery }}" class="deployment-link">
                                        {{ .Name }}
                                    </a>
                                </td>
                                <td>{{ .Ready }}</td>
                                <td>{{ .Owner }}</td>
                                <td>{{ .Age }}</td>
                            </tr>
                            {{ else }}
                            <tr><td colspan="4" class="no-data">No replicasets found.</td></tr>
                            {{ end }}
                        </tbody>
                    </table>
                </div>
            </div>
        {{ end }}
    </main>

    <script>
        // Updated tab logic to match the new class names
        function openTab(clusterName, btn) {
            // Hide all tabs
            document.querySelectorAll('.deployment-content').forEach(el => {
                el.classList.remove('active');
            });
            // Deselect all buttons
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
            });

            // Show selected tab
            const target = document.getElementById('tab-' + clusterName);
            if (target) {
                target.classList.add('active');
            }

            // Highlight button
            btn.classList.add('active');
        }
    </script>
</body>
</html>